{% extends "base.html" %}
{% block title %}Booking & Reservation History{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Your Parking History</h2>

  <!-- Total Spent -->
  <div class="alert alert-primary">
    <strong>Total Spent:</strong> ₹{{ total_cost }}
  </div>

  {% if bookings %}
    <h4>Lot Bookings</h4>
    <ul class="list-group mb-4">
      {% for booking in bookings %}
      <li class="list-group-item">
        <strong>Lot:</strong> {{ booking.parking_lot.prime_location_name }}<br>
        <strong>Start:</strong> {{ booking.start_time.strftime('%d %b %Y, %I:%M %p') }}<br>
        <strong>End:</strong>
        {% if booking.end_time %}
          {{ booking.end_time.strftime('%d %b %Y, %I:%M %p') }}
        {% else %}
          <em>Still Active</em>
        {% endif %}<br>
        <strong>Duration:</strong> {{ booking.duration_hours() }}<br>
        <strong>Cost:</strong>
        {% if booking.end_time %}
          ₹{{ "%.2f"|format(booking.calculate_price()) }}
        {% else %}
          —
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if reservations %}
    <h4>Spot Reservations</h4>
    <ul class="list-group mb-4">
      {% for res in reservations %}
      <li class="list-group-item">
        <strong>Lot:</strong> {{ res.spot.lot.prime_location_name }}<br>
        <strong>Spot:</strong> #{{ res.spot.id }}<br>
        <strong>From:</strong> {{ res.parking_timestamp.strftime('%d %b %Y, %I:%M %p') }}<br>
        <strong>To:</strong>
        {% if res.leaving_timestamp %}
          {{ res.leaving_timestamp.strftime('%d %b %Y, %I:%M %p') }}
        {% else %}
          <em>Still Reserved</em>
        {% endif %}<br>
        <strong>Duration:</strong> {{ res.duration_hours() }}<br>
        <strong>Cost:</strong>
        {% if res.leaving_timestamp %}
          ₹{{ "%.2f"|format(res.calculate_total_price()) }}
        {% else %}
          —
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if not bookings and not reservations %}
    <p class="text-muted">You have no booking or reservation history yet.</p>
  {% endif %}
</div>
{% endblock %}

